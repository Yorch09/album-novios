<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Álbum por Provincias</title>
  <style>
    svg {
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
    }

    .provincia {
      stroke: #333;
      cursor: pointer;
    }

    .activa {
      stroke: red;
      stroke-width: 3;
    }

    #imagen-container {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Álbum por Provincias</h1>
  <svg id="mapa" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
    <defs id="defs"></defs>

    <rect id="madrid" class="provincia" x="200" y="200" width="100" height="100" fill="#eee" />
    <rect id="valencia" class="provincia" x="350" y="250" width="100" height="100" fill="#eee" />
    <rect id="sevilla" class="provincia" x="100" y="350" width="100" height="100" fill="#eee" />
  </svg>

  <div id="imagen-container" style="display: none;">
    <h2 id="provincia-title"></h2>
    <input type="file" id="input-imagen" accept="image/*" />
    <button onclick="subirImagenProvincia()">Subir Foto</button>
  </div>

  <script>
    const provincias = document.querySelectorAll('.provincia');
    const titulo = document.getElementById('provincia-title');
    const contenedor = document.getElementById('imagen-container');
    let provinciaSeleccionada = null;

    provincias.forEach(prov => {
      prov.addEventListener('click', () => {
        provincias.forEach(p => p.classList.remove('activa'));
        prov.classList.add('activa');
        provinciaSeleccionada = prov;
        const nombre = prov.id.charAt(0).toUpperCase() + prov.id.slice(1);
        titulo.innerText = `Provincia: ${nombre}`;
        contenedor.style.display = 'block';
      });
    });

    function subirImagenProvincia() {
      const input = document.getElementById('input-imagen');
      const archivo = input.files[0];
      if (!archivo || !provinciaSeleccionada) {
        alert("Selecciona una imagen y una provincia.");
        return;
      }

      const lector = new FileReader();
      lector.onload = function () {
        const idProvincia = provinciaSeleccionada.id;
        const urlImagen = lector.result;

        // Crear o actualizar el patrón
        const patternId = `pattern-${idProvincia}`;
        const defs = document.getElementById('defs');
        let pattern = document.getElementById(patternId);

        if (pattern) {
          // Si ya existe, solo actualizamos la imagen
          pattern.querySelector('image').setAttribute('xlink:href', urlImagen);
        } else {
          // Crear nuevo patrón
          pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
          pattern.setAttribute('id', patternId);
          pattern.setAttribute('patternUnits', 'objectBoundingBox');
          pattern.setAttribute('width', '1');
          pattern.setAttribute('height', '1');

          const image = document.createElementNS('http://www.w3.org/2000/svg', 'image');
          image.setAttributeNS(null, 'width', '100');
          image.setAttributeNS(null, 'height', '100');
          image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', urlImagen);

          pattern.appendChild(image);
          defs.appendChild(pattern);
        }

        // Aplicar el patrón a la provincia
        provinciaSeleccionada.setAttribute('fill', `url(#${patternId})`);
      };

      lector.readAsDataURL(archivo);
    }
  </script>
</body>
</html>

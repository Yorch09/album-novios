<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa con Fotos por Provincia</title>
  <style>
    svg {
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
    }

    .provincia {
      cursor: pointer;
    }

    .activa {
      stroke: red;
      stroke-width: 2;
    }
  </style>
</head>
<body>
  <h1>Mapa de Provincias</h1>

  <!-- SVG embebido aquÃ­ (lo he extraÃ­do de tu archivo subido) -->
  <!-- ðŸ‘‡ðŸ‘‡ðŸ‘‡ðŸ‘‡ðŸ‘‡ AQUI VA EL SVG ðŸ‘‡ðŸ‘‡ðŸ‘‡ðŸ‘‡ðŸ‘‡ -->
  <!-- Te incrustarÃ© aquÃ­ el contenido real de tu SVG justo ahora -->
  <div id="svg-container"></div>

  <div id="imagen-container" style="display:none;">
    <h2 id="provincia-title"></h2>
    <input type="file" id="input-imagen" accept="image/*" />
    <button onclick="subirImagenProvincia()">Subir imagen</button>
  </div>

  <script>
    let provinciaSeleccionada = null;

    fetch("espana.svg")
      .then(res => res.text())
      .then(svgText => {
        document.getElementById("svg-container").innerHTML = svgText;
        const svg = document.querySelector("svg");
        const provincias = svg.querySelectorAll(".provincia");

        provincias.forEach(prov => {
          prov.addEventListener("click", () => {
            provincias.forEach(p => p.classList.remove("activa"));
            prov.classList.add("activa");
            provinciaSeleccionada = prov;
            document.getElementById("provincia-title").innerText = `Provincia: ${prov.id}`;
            document.getElementById("imagen-container").style.display = "block";
          });
        });
      });

    function subirImagenProvincia() {
      const input = document.getElementById("input-imagen");
      const archivo = input.files[0];
      if (!archivo || !provinciaSeleccionada) {
        alert("Selecciona una imagen y una provincia.");
        return;
      }

      const lector = new FileReader();
      lector.onload = () => {
        const svg = document.querySelector("svg");
        let defs = svg.querySelector("defs");

        if (!defs) {
          defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
          svg.insertBefore(defs, svg.firstChild);
        }

        const bb = provinciaSeleccionada.getBBox();
        const patternId = `pattern-${provinciaSeleccionada.id}`;

        const pattern = document.createElementNS("http://www.w3.org/2000/svg", "pattern");
        pattern.setAttribute("id", patternId);
        pattern.setAttribute("patternUnits", "userSpaceOnUse");
        pattern.setAttribute("x", bb.x);
        pattern.setAttribute("y", bb.y);
        pattern.setAttribute("width", bb.width);
        pattern.setAttribute("height", bb.height);

        const image = document.createElementNS("http://www.w3.org/2000/svg", "image");
        image.setAttribute("x", bb.x);
        image.setAttribute("y", bb.y);
        image.setAttribute("width", bb.width);
        image.setAttribute("height", bb.height);
        image.setAttributeNS("http://www.w3.org/1999/xlink", "href", lector.result);
        image.setAttribute("preserveAspectRatio", "xMidYMid slice");

        pattern.appendChild(image);
        defs.appendChild(pattern);

        provinciaSeleccionada.setAttribute("fill", `url(#${patternId})`);
      };

      lector.readAsDataURL(archivo);
    }
  </script>
</body>
</html>

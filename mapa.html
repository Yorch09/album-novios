<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Álbum por Provincias Fotos</title>
  <style>
    svg {
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
    }

    .provincia {
      stroke: #333;
      cursor: pointer;
    }

    .activa {
      stroke: red;
      stroke-width: 3;
    }

    #imagen-container {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Álbum por Provincias Fotos</h1>
  <object type="image/svg+xml" data="espana.svg" id="mapa"></object>

  <div id="imagen-container" style="display: none;">
    <h2 id="provincia-title"></h2>
    <input type="file" id="input-imagen" accept="image/*" />
    <button onclick="subirImagenProvincia()">Subir Foto</button>
  </div>

  <script>
    const provincias = document.querySelectorAll('.provincia');
    const titulo = document.getElementById('provincia-title');
    const contenedor = document.getElementById('imagen-container');
    let provinciaSeleccionada = null;

    provincias.forEach(prov => {
      prov.addEventListener('click', () => {
        provincias.forEach(p => p.classList.remove('activa'));
        prov.classList.add('activa');
        provinciaSeleccionada = prov;
        const nombre = prov.id.charAt(0).toUpperCase() + prov.id.slice(1);
        titulo.innerText = `Provincia: ${nombre}`;
        contenedor.style.display = 'block';
      });
    });

    function subirImagenProvincia() {
  const input = document.getElementById('input-imagen');
  const archivo = input.files[0];
  if (!archivo || !provinciaSeleccionada) return alert("Selecciona una imagen y provincia.");
  const lector = new FileReader();
  lector.onload = () => {
    const { el, svg, defs } = provinciaSeleccionada;
    const bb = el.getBBox();
    const { x, y, width, height } = bb;
    const patternId = `pattern-${el.id}`;
    let pattern = svg.getElementById(patternId);
    if (pattern) {
      pattern.querySelector('image').setAttributeNS('http://www.w3.org/1999/xlink','href', lector.result);
    } else {
      pattern = document.createElementNS('http://www.w3.org/2000/svg','pattern');
      pattern.setAttribute('id', patternId);
      pattern.setAttribute('patternUnits', 'userSpaceOnUse');
      pattern.setAttribute('x', x);
      pattern.setAttribute('y', y);
      pattern.setAttribute('width', width);
      pattern.setAttribute('height', height);

      const image = document.createElementNS('http://www.w3.org/2000/svg','image');
      image.setAttribute('x', x);
      image.setAttribute('y', y);
      image.setAttribute('width', width);
      image.setAttribute('height', height);
      image.setAttributeNS('http://www.w3.org/1999/xlink','href', lector.result);

      pattern.appendChild(image);
      defs.appendChild(pattern);
    }
    el.setAttribute('fill', `url(#${patternId})`);
  };
  lector.readAsDataURL(archivo);
}

  </script>
</body>
</html>
